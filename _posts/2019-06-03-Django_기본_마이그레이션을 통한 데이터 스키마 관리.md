---
layout: post
title:  "Django_기본.migration으로 데이터 스키마 관리"
comments: true
description: "Django"
author: SeungHyeon Tak
date:   2019-06-03 21:15:11 +0700
categories: [Django]
tags: [Django]
keywords: "Django"
---
#### Django.기본 웹 개발

* Migrations
  * 모델의 변경내역을 데이터베이스 스키마로 반영시키는 효율
  * 관련 명령어
    * 마이그레이션 파일 생성
    (python manage.py makemigrations <앱이름>)
   * 지정 데이터베이스에 마이그레이션 적용
      (python manage.py migrate <앱이름>)
   * 마이그레이션 적용 현황 출력
      (python manage.py showmigrations <앱이름>)
   * 지정 마이그레이션의 SQL 내역 출력
      (python manage.py sqlmigrate <앱이름> <마이그레이션-이름>)
<br>

* makemigrtaions 할때는 언제인가
  * 모델 필드 관련된 어떠한 변경이 발생할때 마이그레이션 파일 생성
  * 마이그레이션 파일은 모델의 변경내역을 누적하는 역할
  * Tip. 마이그레이션 파일이 너무 많아질 경우 , squashmigrations 명령으로 다수의 마이그레이션 파일을 통합 가능 
<br>
* 새로운 필드가 필수 필드라고할때
  * 필수필드 여부 : blank/null 옵션이 모두 False 일때
  * makemigrations 명령을 수행할 때, 기존 Record들에 어떤 값을 채워 넣을지 묻는다.
    * 선택1) 지금 그 값을 입력하겠다.
    * 선택2) 명령 수행을 중단.
이 부분에 대해 정확한 정의를 내리지 못하겠다. 좀 더 알아봐야 알듯하다
<br>

*협업 Tip*
* 절대 하지 말아야할 일
  * 팀원 각자가 마이그레이션 파일을 생성 -> 충돌 발생
(추천) : 마이그레이션 파일 생성은 1명이 전담해서 생성
  * 생성한 마이그레이션 파일을 버전관리에 넣고, 다른 팀원들은 이를 받아서 migrate만 수행
* 개발 시에 '서버에 아직 반영하지 않은' 마이그레이션을 다수 생성 했다면?
  * 이를 그대로 서버에 반영(migrate)하지말고, 하나의 마이그레이션으로 합쳐서 적용하기
    * 방법1) 서버로의 미적용 마이그레이션들을 모두 롤백하고 - 롤백된 마이그레이션들을 모두 제거하고 새로운 마이그레이션 파일 생성
    * 방법2) 미적용 마이그레이션들을 하나로 합치기 - squashmigrations