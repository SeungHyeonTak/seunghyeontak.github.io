---
layout: post
title:  "Django_28.(SNS 이미지 앱 만들기)회원가입 기능 구현"
comments: true
description: "Django_part28"
author: SeungHyeon Tak
date:   2019-05-21 18:46:54 +0700
categories: [Django]
tags: [Django]
keywords: "Django"
---
#### Django.28 웹 개발
<br>
### 회원가입

* MTV 순으로 구현
  * M 은 구현안함
<br>
* `urls.py` 부터 구현 시작

```python
from insta import views as insta_views

urlpatterns = [
	...
    # 회원가입
    path('accounts/signup', insta_views.CreateUserView.as_view(), name = 'signup'),
    # 회원가입 후 로그인
    path('accounts/signup_done', insta_views.RegisteredView.as_view(),name = 'create_user_done'),
]
```
<br>

* `views.py` 구현

```python
#회원가입 form - id / pw 만 확인 - 현재 form (이메일없기때문에 추가)
from django.contrib.auth.forms import UserCreationForm

# * 이건 Django 1.x 버전꺼
#from django.core.urlresolvers import reverse_lazy

# * 이건 Django 2.x 버전꺼
from django.urls import reverse_lazy

from .forms import CreateUserForm

...

class CreateUserView(CreateView):
    template_name = 'registration/signup.html' # 연결
    #form_class = CreateUserForm
    form_class = UserCreationForm # 만든거 아님 위에꺼 그대로 쓴거
    success_url = reverse_lazy('create_user_done') # 성공하면 여기로

class RegisteredView(TemplateView):
    template_name = 'registration/signup_done.html'
```
* registration 부분에 `login.html` 부분 수정하기<br> 
<a href="https://github.com/SeungHyeonTak/HTML-study/blob/master/insta/login.html">Login code</a>
<br>
* 추가로 `singup.html` 추가하기<br>
<a href="https://github.com/SeungHyeonTak/HTML-study/blob/master/insta/singup.html">singup code</a>
<br>
* `singup_done.html`<br>
<a href="https://github.com/SeungHyeonTak/HTML-study/blob/master/insta/singup_done.html">singup code</a>
<br>
* 이렇게 하고 runserver를 돌려본다.

#### 이제 E-mail 부분 구현하기
* `forms.py` 하나 만들기 (app 부분에 만들기)

```python
from django.contrib.auth.models import User
from django.contrib.auth.forms import UserCreationForm
from django import forms

class CreateUserForm(UserCreationForm):
    email = forms.EmailField(required=True)

    class Meta:
        model = User
        fields = ("username", "email", "password1", "password2")

    def save(self, commit=True):
        user = super(CreateUserForm, self).save(commit=False)
        user.email = self.cleaned_data["email"]
        if commit:
            user.save()
        return user
```

* 수정할 부분
* `views.py` 에서 수정

```python
from .forms import CreateUserForm

...

class CreateUserView(CreateView):
    template_name = 'registration/signup.html' # 연결
    form_class = CreateUserForm  # 이 부분 주석 풀어주기
    #form_class = UserCreationForm # 만든거 아님 위에꺼 그대로 쓴거
    success_url = reverse_lazy('create_user_done') # 성공하면 여기로
```

<br>
* 이렇게 E-mail 부분이 추가 됨을 알 수 있다.
